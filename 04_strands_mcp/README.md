# Strands Agents MCP é›†æˆæŒ‡å—

æ¬¢è¿æ¥åˆ° Strands in 5 minutes å¿«é€Ÿä¸Šæ‰‹ç³»åˆ—ï¼ä»Šå¤©æˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•ä½¿ç”¨ Strands Agents é›†æˆ MCPï¼ˆæ¨¡å‹ä¸Šä¸‹æ–‡åè®®ï¼‰ï¼Œè®© AI Agent è½»æ¾è°ƒç”¨å¤–éƒ¨å·¥å…·å’ŒæœåŠ¡ï¼Œæ‰©å±•Agent èƒ½åŠ›ã€‚

## ä»€ä¹ˆæ˜¯ MCPï¼Ÿ
MCPï¼ˆModel Context Protocolï¼‰æ˜¯ä¸€ç§å¼€æ”¾åè®®ï¼Œæ ‡å‡†åŒ–äº† AI Agent ä¸å¤–éƒ¨å·¥å…·å’ŒæœåŠ¡çš„äº¤äº’æ–¹å¼ã€‚å®ƒåƒä¸€ä¸ªâ€œä¸‡èƒ½æ’åº§â€ï¼Œè®© Agent æ— éœ€å…³å¿ƒæœåŠ¡ç»†èŠ‚ï¼Œå°±èƒ½è°ƒç”¨æ•°æ®åº“ã€APIã€æ–‡ä»¶ç³»ç»Ÿç­‰å¤šç§å·¥å…·ã€‚Strands Agents å†…ç½®å¯¹ MCP çš„æ”¯æŒï¼Œèƒ½è½»æ¾è¿æ¥ MCP æœåŠ¡å™¨ï¼Œè‡ªåŠ¨å‘ç°å’Œè°ƒç”¨å…¶æä¾›çš„å·¥å…·ã€‚

## MCP ä½œç”¨
- **ç»Ÿä¸€æ¥å£**ï¼šä¸åŒæœåŠ¡ç”¨åŒä¸€åè®®æ¥å…¥ï¼Œç®€åŒ–é›†æˆå¤æ‚åº¦
- **å¤šè¯­è¨€&å¤šå¹³å°**ï¼šæ”¯æŒä»»æ„è¯­è¨€ç¼–å†™çš„æœåŠ¡ï¼Œæ”¯æŒæœ¬åœ°ã€äº‘ç«¯å¤šç§éƒ¨ç½²
- **åŠ¨æ€å‘ç°å·¥å…·**ï¼šAgent å¯åŠ¨æ—¶è‡ªåŠ¨è·å– MCP æœåŠ¡å™¨ä¸Šçš„æ‰€æœ‰å·¥å…·
- **å®‰å…¨å¯é **ï¼šé€šè¿‡ä¸Šä¸‹æ–‡ç®¡ç†ç¡®ä¿è¿æ¥ç”Ÿå‘½å‘¨æœŸå’Œèµ„æºé‡Šæ”¾

## Strands Agents çš„ MCP ä¼˜åŠ¿

- **MCP Server æ„å»º** - ä½¿ç”¨ `FastMCP` å¿«é€Ÿåˆ›å»ºæœåŠ¡å™¨  
- **MCP Client é›†æˆ** - ä¸€è¡Œä»£ç è¿æ¥ä»»ä½• MCP æœåŠ¡  
- **å·¥å…·è‡ªåŠ¨å‘ç°** - è‡ªåŠ¨è·å–è¿œç¨‹å·¥å…·  
- **æ— ç¼é›†æˆ** - Agent é€æ˜è°ƒç”¨è¿œç¨‹æœåŠ¡

## Strands æ”¯æŒçš„ MCP Server è¿æ¥æ–¹å¼

| è¿æ¥æ–¹å¼               | è¯´æ˜                                             |
|------------------------|--------------------------------------------------|
| **æ ‡å‡†è¾“å…¥è¾“å‡ºï¼ˆstdioï¼‰** | é€‚åˆæœ¬åœ°è¿›ç¨‹é—´é€šä¿¡ï¼ŒåŸºäºæ ‡å‡†è¾“å…¥è¾“å‡ºæµäº¤æ¢æ•°æ®           |
| **Streamable HTTP**     | åŸºäº HTTP åè®®çš„æµå¼äº‹ä»¶ä¼ è¾“ï¼Œé€‚åˆç½‘ç»œæœåŠ¡è°ƒç”¨             |
| **Server-Sent Events (SSE)** | åŸºäº SSE çš„äº‹ä»¶æ¨é€æ–¹å¼ï¼Œæ”¯æŒæœåŠ¡å™¨ä¸»åŠ¨æ¨é€æ¶ˆæ¯           |
| **è‡ªå®šä¹‰ä¼ è¾“åè®®**       | é«˜çº§ç”¨æˆ·å¯å®ç°è‡ªå®šä¹‰çš„ MCP ä¼ è¾“åè®®ï¼Œæ»¡è¶³ç‰¹æ®Šéœ€æ±‚             |


## Demo ä»‹ç»
æœ¬ Demo å±•ç¤ºäº†ä¸€ä¸ªåŸºäºMCPçš„ç¾é£Ÿèœè°±æ™ºèƒ½Agentï¼Œå®ƒç”±æä¾›ç¾é£Ÿèœè°±æ•°æ®æœåŠ¡çš„MCP Serverå’Œä½œä¸ºClientçš„Agentç»„æˆï¼Œé€šè¿‡MCPè·å–èœè°±ä¿¡æ¯ï¼Œå®ç°èœç³»æŸ¥è¯¢ã€èœè°±æ¨èã€é£Ÿææœç´¢ç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚


![Demo æ¶æ„å›¾](mcp_architecture.png)


## Demo æµç¨‹
### 1. æ„å»º MCP Server

Strands å†…ç½® FastMCPï¼Œè®©ä½ è½»æ¾åˆ›å»º MCP æœåŠ¡å™¨ã€‚ä»¥ç¾é£ŸMCP Serverä¸ºä¾‹ï¼š

```python
from mcp.server import FastMCP

# 1. åˆ›å»º MCP æœåŠ¡å™¨å®ä¾‹
mcp = FastMCP(name="Chinese Cuisine Recipe Service", host="0.0.0.0", port=8080)

# 2. å‡†å¤‡æ•°æ®æº
RECIPE_CATALOG = {
    "sichuan": {"title": "å·èœ", "recipes": [...]},
    "cantonese": {"title": "ç²¤èœ", "recipes": [...]},
    # ... æ›´å¤šèœç³»æ•°æ®
}

# 3. å®šä¹‰å·¥å…·å‡½æ•°ï¼Œé‡‡ç”¨`@mcp.tool()` è‡ªåŠ¨å°†å‡½æ•°æš´éœ²ä¸º MCP å·¥å…·
@mcp.tool()
def list_cuisines() -> dict:
    """åˆ—å‡ºæ‰€æœ‰å¯ç”¨çš„ä¸­é¤èœç³»"""
    return {"available_cuisines": {...}}

@mcp.tool() 
def get_recipes_by_cuisine(cuisine: str) -> dict:
    """è·å–æŒ‡å®šèœç³»çš„èœè°±"""
    return RECIPE_CATALOG.get(cuisine.lower(), {})

@mcp.tool()
def search_recipes_by_ingredient(ingredient: str) -> dict:
    """æ ¹æ®é£Ÿææœç´¢ç›¸å…³èœè°±"""
    return {"matching_recipes": [...]}

# 4. å¯åŠ¨æœåŠ¡å™¨
if __name__ == "__main__":
    mcp.run(transport="streamable-http")
```

### 2. å¯åŠ¨MCP Server

```bash
python strands_mcp_server.py
```
å¯åŠ¨åæ˜¾ç¤ºå¦‚ä¸‹
```
INFO:     Started server process
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     Uvicorn running on http://0.0.0.0:8080 (Press CTRL+C to quit)
```
**ä¿æŒæœåŠ¡å™¨è¿è¡Œ**ï¼ŒAgent éœ€è¦è¿æ¥åˆ°æ­¤æœåŠ¡ï¼ŒæŸ¥è¯¢èœè°±æ•°æ®



### 3. åˆ›å»ºèœè°±Agent

 `strands_cooking_agent.py`ï¼š

```python

# è¿æ¥ MCP æœåŠ¡å™¨
mcp_client = MCPClient(lambda: streamablehttp_client("http://localhost:8080/mcp"))

with mcp_client:
    # åˆ›å»º Agent å¹¶æ³¨å†Œ MCP å·¥å…·
    agent = Agent(model=model, system_prompt="ä½ æ˜¯ä¸­åç¾é£Ÿä¸“å®¶...")
    mcp_tools = mcp_client.list_tools_sync()
    agent.tool_registry.process_tools(mcp_tools)
    
    # å¼€å§‹äº¤äº’
    while True:
        user_input = input("\næ‚¨çš„éœ€æ±‚: ")
        if user_input.lower() in ["exit", "é€€å‡º"]:
            break
        agent(user_input)

```

### 4. è¿è¡Œ Agent
åœ¨æ–°ç»ˆç«¯å¯åŠ¨ï¼ˆä¿æŒæœåŠ¡å™¨è¿è¡Œï¼‰ï¼š
```bash
python strands_cooking_agent.py
```

Agent å¯åŠ¨åä¼šæ˜¾ç¤ºè¯¦ç»†çš„å·¥å…·å‘ç°è¿‡ç¨‹ï¼š
```
Connecting to MCP Server...
ğŸ” æ­£åœ¨å‘ç° MCP æœåŠ¡å™¨ä¸Šçš„å·¥å…·...
âœ… å‘ç° 3 ä¸ªå¯ç”¨å·¥å…·:
   1. list_cuisines - åˆ—å‡ºæ‰€æœ‰å¯ç”¨çš„ä¸­é¤èœç³»
   2. get_recipes_by_cuisine - è·å–æŒ‡å®šèœç³»çš„èœè°±
   3. search_recipes_by_ingredient - æ ¹æ®é£Ÿææœç´¢ç›¸å…³èœè°±

ğŸ”§ æ­£åœ¨æ³¨å†Œå·¥å…·åˆ° Agent...
âœ… å·¥å…·æ³¨å†Œå®Œæˆï¼

ğŸ³ ä¸­åç¾é£Ÿä¸“å®¶ - MCP é›†æˆç‰ˆ
==================================================
ğŸ¥¢ è¯•è¯•é—®ï¼š'æœ‰å“ªäº›èœç³»ï¼Ÿ' æˆ– 'æ¨èä¸€é“å·èœ' æˆ– 'ç”¨çŒªè‚‰èƒ½åšä»€ä¹ˆèœï¼Ÿ'
```

### å·¥å…·è°ƒç”¨å®æ—¶ç›‘æ§
å½“ç”¨æˆ·æé—®æ—¶ï¼Œæ§åˆ¶å°ä¼šå®æ—¶æ˜¾ç¤ºå·¥å…·è°ƒç”¨è¿‡ç¨‹ï¼š
```
æ‚¨çš„éœ€æ±‚: æœ‰å“ªäº›èœç³»ï¼Ÿ

æ­£åœ¨ä¸ºæ‚¨æŸ¥æ‰¾...

ğŸ¤– Agent å¼€å§‹å¤„ç†æ‚¨çš„è¯·æ±‚...
ğŸ› ï¸  è°ƒç”¨å·¥å…·: list_cuisines
ğŸ“¤ ç»“æœ: {'available_cuisines': {'sichuan': {'title': 'å·èœ', 'recipe_count': 2}, ...}}
----------------------------------------
ğŸ“Š æœ¬æ¬¡å…±è°ƒç”¨äº† 1 ä¸ªå·¥å…·
```

### 5. æµ‹è¯• Agent

**æµ‹è¯•1ï¼šæŸ¥è¯¢èœç³»åŠŸèƒ½**
```
æœ‰å“ªäº›èœç³»ï¼Ÿ
```

**æµ‹è¯•2ï¼šèœè°±æ¨èåŠŸèƒ½**
```
æ¨èä¸€é“å·èœ
```

**æµ‹è¯•3ï¼šé£Ÿææœç´¢åŠŸèƒ½**
```
ç”¨çŒªè‚‰èƒ½åšä»€ä¹ˆèœï¼Ÿ
```

## æ€»ç»“
åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å·²ç»ï¼š  

âœ… æ„å»ºäº†ä¸€ä¸ªç®€å•çš„ MCP æœåŠ¡å™¨ï¼Œæ¼”ç¤ºå¤–éƒ¨æœåŠ¡é›†æˆ  
âœ… ä»¥æœ€å°‘ä»£ç å°† Agent è¿æ¥åˆ° MCP æœåŠ¡å™¨  
âœ… å®ç°äº†é€šè¿‡è‡ªç„¶è¯­è¨€çš„æ— ç¼å·¥å…·è°ƒç”¨  
âœ… ç†è§£äº† Strands Agents SDK å¦‚ä½•ç®€åŒ–äº† MCP çš„å¤æ‚æ€§ 

Strands Agents + MCP è®© AI Agent å…·å¤‡äº†å³æ’å³ç”¨ã€è·¨è¯­è¨€ã€è·¨å¹³å°ã€å¤šæœåŠ¡ç»„åˆçš„å¼ºå¤§èƒ½åŠ›ã€‚åªéœ€å‡ è¡Œä»£ç ï¼Œé€šè¿‡ MCP å³å¯è®© Strands è¿æ¥ä¸°å¯Œçš„å¤–éƒ¨å·¥å…·ï¼Œå¿«é€Ÿæ„å»ºæ™ºèƒ½ä½“åº”ç”¨ã€‚