# Strands Agents MCP é›†æˆæŒ‡å—

æ¬¢è¿æ¥åˆ° Strands in 5 minutes å¿«é€Ÿä¸Šæ‰‹ç³»åˆ—ï¼ä»Šå¤©æˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•ä½¿ç”¨ Strands Agents é›†æˆ MCPï¼ˆæ¨¡å‹ä¸Šä¸‹æ–‡åè®®ï¼‰ï¼Œè®© AI Agent è½»æ¾è°ƒç”¨å¤–éƒ¨å·¥å…·å’ŒæœåŠ¡ï¼Œæå¤§æ‰©å±•æ™ºèƒ½ä½“èƒ½åŠ›ã€‚

ä»€ä¹ˆæ˜¯ MCPï¼Ÿ
MCPï¼ˆModel Context Protocolï¼‰æ˜¯ä¸€ç§å¼€æ”¾åè®®ï¼Œæ ‡å‡†åŒ–äº† AI Agent ä¸å¤–éƒ¨å·¥å…·å’ŒæœåŠ¡çš„äº¤äº’æ–¹å¼ã€‚å®ƒåƒä¸€ä¸ªâ€œä¸‡èƒ½æ’åº§â€ï¼Œè®© Agent æ— éœ€å…³å¿ƒæœåŠ¡ç»†èŠ‚ï¼Œå°±èƒ½è°ƒç”¨æ•°æ®åº“ã€APIã€æ–‡ä»¶ç³»ç»Ÿç­‰å¤šç§å·¥å…·ã€‚

Strands Agents å†…ç½®å¯¹ MCP çš„æ”¯æŒï¼Œèƒ½è½»æ¾è¿æ¥ MCP æœåŠ¡å™¨ï¼Œè‡ªåŠ¨å‘ç°å’Œè°ƒç”¨å…¶æä¾›çš„å·¥å…·ã€‚



## Strands Agents MCP èƒ½åŠ›æ¦‚è§ˆ

### ä»€ä¹ˆæ˜¯ MCPï¼Ÿ
MCPï¼ˆæ¨¡å‹ä¸Šä¸‹æ–‡åè®®ï¼‰æ˜¯è¿æ¥ AI Agent ä¸å¤–éƒ¨æœåŠ¡çš„å¼€æ”¾æ ‡å‡†ï¼Œæ”¯æŒæ•°æ®åº“ã€APIã€æ–‡ä»¶ç³»ç»Ÿç­‰å„ç§æœåŠ¡ã€‚

## MCP æ ¸å¿ƒä¼˜åŠ¿
ç»Ÿä¸€æ¥å£ï¼šä¸åŒæœåŠ¡ç”¨åŒä¸€åè®®æ¥å…¥ï¼Œç®€åŒ–é›†æˆå¤æ‚åº¦
å¤šè¯­è¨€ & å¤šå¹³å°ï¼šæ”¯æŒä»»æ„è¯­è¨€ç¼–å†™çš„æœåŠ¡ï¼Œæ”¯æŒæœ¬åœ°ã€äº‘ç«¯å¤šç§éƒ¨ç½²
åŠ¨æ€å‘ç°å·¥å…·ï¼šAgent å¯åŠ¨æ—¶è‡ªåŠ¨è·å– MCP æœåŠ¡å™¨ä¸Šçš„æ‰€æœ‰å·¥å…·
å®‰å…¨å¯é ï¼šé€šè¿‡ä¸Šä¸‹æ–‡ç®¡ç†ç¡®ä¿è¿æ¥ç”Ÿå‘½å‘¨æœŸå’Œèµ„æºé‡Šæ”¾

### Strands Agents çš„ MCP ä¼˜åŠ¿

**MCP æœåŠ¡å™¨æ„å»º** - ä½¿ç”¨ FastMCP å¿«é€Ÿåˆ›å»ºæœåŠ¡å™¨  
**MCP å®¢æˆ·ç«¯é›†æˆ** - ä¸€è¡Œä»£ç è¿æ¥ä»»ä½• MCP æœåŠ¡  
**å·¥å…·è‡ªåŠ¨å‘ç°** - è‡ªåŠ¨è·å–å¹¶æ³¨å†Œè¿œç¨‹å·¥å…·  
**æ— ç¼é›†æˆ** - Agent é€æ˜è°ƒç”¨è¿œç¨‹æœåŠ¡

### Strands æ”¯æŒçš„ MCP æœåŠ¡å™¨è¿æ¥æ–¹å¼

| è¿æ¥æ–¹å¼               | è¯´æ˜                                             |
|------------------------|--------------------------------------------------|
| **æ ‡å‡†è¾“å…¥è¾“å‡ºï¼ˆstdioï¼‰** | é€‚åˆæœ¬åœ°è¿›ç¨‹é—´é€šä¿¡ï¼ŒåŸºäºæ ‡å‡†è¾“å…¥è¾“å‡ºæµäº¤æ¢æ•°æ®           |
| **Streamable HTTP**     | åŸºäº HTTP åè®®çš„æµå¼äº‹ä»¶ä¼ è¾“ï¼Œé€‚åˆç½‘ç»œæœåŠ¡è°ƒç”¨             |
| **Server-Sent Events (SSE)** | åŸºäº SSE çš„äº‹ä»¶æ¨é€æ–¹å¼ï¼Œæ”¯æŒæœåŠ¡å™¨ä¸»åŠ¨æ¨é€æ¶ˆæ¯           |
| **è‡ªå®šä¹‰ä¼ è¾“åè®®**       | é«˜çº§ç”¨æˆ·å¯å®ç°è‡ªå®šä¹‰çš„ MCP ä¼ è¾“åè®®ï¼Œæ»¡è¶³ç‰¹æ®Šéœ€æ±‚             |


### Demo ä»‹ç»

![Demo æ¶æ„å›¾](mcp_architecture.png)


```python
# Strands MCP é›†æˆæ ¸å¿ƒä»£ç 
mcp_client = MCPClient(lambda: streamablehttp_client("http://localhost:8080/mcp"))
with mcp_client:
    tools = mcp_client.list_tools_sync()  # è‡ªåŠ¨å‘ç°å·¥å…·
    agent = Agent(model=model, tools=tools)  # æ— ç¼é›†æˆ
```

## æ„å»º MCP æœåŠ¡å™¨ï¼ˆServer ç«¯ï¼‰

Strands å†…ç½® FastMCPï¼Œè®©ä½ è½»æ¾åˆ›å»º MCP æœåŠ¡å™¨ã€‚ä»¥ç¾é£ŸMCP Serverä¸ºä¾‹ï¼š

```python
from mcp.server import FastMCP

# 1. åˆ›å»º MCP æœåŠ¡å™¨å®ä¾‹
mcp = FastMCP(name="Chinese Cuisine Recipe Service", host="0.0.0.0", port=8080)

# 2. å‡†å¤‡æ•°æ®æº
RECIPE_CATALOG = {
    "sichuan": {"title": "å·èœ", "recipes": [...]},
    "cantonese": {"title": "ç²¤èœ", "recipes": [...]},
    # ... æ›´å¤šèœç³»æ•°æ®
}

# 3. å®šä¹‰å·¥å…·å‡½æ•°ï¼ˆè‡ªåŠ¨æš´éœ²ä¸º MCP å·¥å…·ï¼‰
@mcp.tool()
def list_cuisines() -> dict:
    """åˆ—å‡ºæ‰€æœ‰å¯ç”¨çš„ä¸­é¤èœç³»"""
    return {"available_cuisines": {...}}

@mcp.tool() 
def get_recipes_by_cuisine(cuisine: str) -> dict:
    """è·å–æŒ‡å®šèœç³»çš„èœè°±"""
    return RECIPE_CATALOG.get(cuisine.lower(), {})

@mcp.tool()
def search_recipes_by_ingredient(ingredient: str) -> dict:
    """æ ¹æ®é£Ÿææœç´¢ç›¸å…³èœè°±"""
    return {"matching_recipes": [...]}

# 4. å¯åŠ¨æœåŠ¡å™¨
if __name__ == "__main__":
    mcp.run(transport="streamable-http")
```

### å…³é”®ç‰¹æ€§ï¼š
- **è£…é¥°å™¨æ¨¡å¼**ï¼š`@mcp.tool()` è‡ªåŠ¨å°†å‡½æ•°æš´éœ²ä¸º MCP å·¥å…·
- **ç±»å‹å®‰å…¨**ï¼šæ”¯æŒç±»å‹æ³¨è§£å’Œè‡ªåŠ¨éªŒè¯
- **å¤šä¼ è¾“åè®®**ï¼šæ”¯æŒ HTTPã€WebSocket ç­‰ä¼ è¾“æ–¹å¼

å¯åŠ¨æœåŠ¡å™¨ï¼š

```bash
uv run python strands_mcp_server.py
# è¾“å‡ºï¼šUvicorn running on http://0.0.0.0:8080
```

**ä¿æŒæœåŠ¡å™¨è¿è¡Œ**ï¼ŒAgent éœ€è¦è¿æ¥æ­¤æœåŠ¡

## ç¬¬ä¸‰æ­¥ï¼šåˆ›å»ºç¾é£Ÿä¸“å®¶ Agent

åˆ›å»º `strands_cooking_agent.py`ï¼š

```python
from strands import Agent
from strands.tools.mcp import MCPClient
from mcp.client.streamable_http import streamablehttp_client
from strands.models import BedrockModel

# é…ç½®æ¨¡å‹
model = BedrockModel(
    model_id="us.anthropic.claude-sonnet-4-20250514-v1:0",
    region_name="us-west-2"
)

def main():
    # è¿æ¥ MCP æœåŠ¡å™¨
    mcp_client = MCPClient(lambda: streamablehttp_client("http://localhost:8080/mcp"))
    
    with mcp_client:
        # åˆ›å»º Agent å¹¶æ³¨å†Œ MCP å·¥å…·
        agent = Agent(model=model, system_prompt="ä½ æ˜¯ä¸­åç¾é£Ÿä¸“å®¶...")
        mcp_tools = mcp_client.list_tools_sync()
        agent.tool_registry.process_tools(mcp_tools)
        
        # å¼€å§‹äº¤äº’
        while True:
            user_input = input("\næ‚¨çš„éœ€æ±‚: ")
            if user_input.lower() in ["exit", "é€€å‡º"]:
                break
            agent(user_input)

if __name__ == "__main__":
    main()
```

## ç¬¬å››æ­¥ï¼šè¿è¡Œ Agent

åœ¨æ–°ç»ˆç«¯å¯åŠ¨ï¼ˆä¿æŒæœåŠ¡å™¨è¿è¡Œï¼‰ï¼š

```bash
uv run python strands_cooking_agent.py
```

çœ‹åˆ°å·¥å…·åˆ—è¡¨è¯´æ˜è¿æ¥æˆåŠŸï¼Œå¼€å§‹å¯¹è¯å§ï¼
## å®é™…æ•ˆæœæ¼”ç¤º

### ğŸ” æŸ¥è¯¢èœç³»
**é—®ï¼š** "æœ‰å“ªäº›èœç³»ï¼Ÿ"  
**ç­”ï¼š** å·èœ(2é“)ã€ç²¤èœ(1é“)ã€æ·®æ‰¬èœ(1é“)

### ğŸ² æ¨èå·èœ  
**é—®ï¼š** "æ¨èä¸€é“å·èœ"  
**ç­”ï¼š** éº»å©†è±†è…(ç®€å•|20åˆ†é’Ÿ)ã€å®«ä¿é¸¡ä¸(ä¸­ç­‰|25åˆ†é’Ÿ)

### ğŸ¥˜ é£Ÿææœç´¢
**é—®ï¼š** "ç”¨é¸¡è‚‰èƒ½åšä»€ä¹ˆèœï¼Ÿ"  
**ç­”ï¼š** å®«ä¿é¸¡ä¸(å·èœ)ã€ç™½åˆ‡é¸¡(ç²¤èœ)

## é«˜çº§ç”¨æ³•

ä¹Ÿå¯ä»¥ç›´æ¥è°ƒç”¨ MCP å·¥å…·ï¼š

```python
# ç›´æ¥å·¥å…·è°ƒç”¨
cuisines = agent.tool.list_cuisines()
recipes = agent.tool.get_recipes_by_cuisine("sichuan")
```

## MCP æ ¸å¿ƒä¼˜åŠ¿

ğŸ”Œ **å³æ’å³ç”¨** - ç»Ÿä¸€æ¥å£ï¼Œæ— éœ€äº†è§£æœåŠ¡å†…éƒ¨å®ç°  
ğŸŒ **æŠ€æœ¯æ— å…³** - ä»»ä½•è¯­è¨€ç¼–å†™ï¼Œä»»ä½•åœ°æ–¹éƒ¨ç½²  
ğŸš€ **è½»æ¾æ‰©å±•** - åŒæ—¶è¿æ¥å¤šä¸ªæœåŠ¡ï¼Œç»„åˆåŠŸèƒ½

```python
# å¤šæœåŠ¡é›†æˆ
recipe_service = MCPClient(...)
nutrition_service = MCPClient(...)

with recipe_service, nutrition_service:
    tools = recipe_service.list_tools_sync() + nutrition_service.list_tools_sync()
    agent = Agent(model=model, tools=tools)  # å…¨èƒ½ç¾é£ŸåŠ©æ‰‹
```


## æ€»ç»“
Strands Agents + MCP è®© AI Agent å…·å¤‡äº†å³æ’å³ç”¨ã€è·¨è¯­è¨€ã€è·¨å¹³å°ã€å¤šæœåŠ¡ç»„åˆçš„å¼ºå¤§èƒ½åŠ›ã€‚åªéœ€å‡ è¡Œä»£ç ï¼Œé€šè¿‡MCPå³è®©Strandså¯è¿æ¥ä¸°å¯Œçš„å¤–éƒ¨å·¥å…·ï¼Œå¿«é€Ÿæ„å»ºæ™ºèƒ½ä½“åº”ç”¨ã€‚